{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="search.css">
    <link href="{% static 'custom.css' %}" rel="stylesheet" type = "text/css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-uWxY/CJNBR+1zjPWmfnSnVxwRheevXITnMqoEIeG1LJrdI0GlVs/9cVSyPYXdcSF" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    

    


    <title>Diary</title>
  </head>
  <body>
    <div class = "sidenav">
        {% include 'partials/profile_pic.html' with user=user %}
        <a href = "/dashboard">Home</a>
        <a href = "/journal_log">Journal Log</a>
        <a href = "/favourites">Favourites</a>
        <a href = "/templates">Templates</a>
        <a href = "/mood_breakdown">Mood Breakdown</a>
        <a href = "/trash">Trash</a>
    </div>
    <div id = "content", name = "content", class = "main">
        {% block body %}
        {% endblock %}
    </div>
    <script src="{% static 'calendar.js' %}"></script>
    <script src="{% static 'speech.js' %}"></script>
    <script src="{% static 'export.js' %}"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.min.js" integrity="sha384-PsUw7Xwds7x08Ew3exXhqzbhuEYmA2xnwc8BuD6SEr+UmEHlX8/MCltYEodzWA4u" crossorigin="anonymous"></script>
    <script src="{% static 'journallog.js' %}"></script>
    <script src="{% static 'trash.js'%}"></script>
    <script>     
      function showFavJournalSuggestions(query) {
    if (query.length >= 1) {
      fetch('{% url "search_favouriteSuggestion" %}?q=' + encodeURIComponent(query))
        .then(response => response.json())
        .then(data => {
          var suggestionsContainer = document.getElementById('Fjournal-suggestions-container');
          suggestionsContainer.innerHTML = '';
          data.suggestions.forEach(title => {
            const div = document.createElement('div');
            div.textContent = title;
            div.classList.add('search-suggestion'); 
            div.addEventListener('click', function() {
              selectJournalSuggestion(title); 
            });
            suggestionsContainer.appendChild(div);
          });
          suggestionsContainer.style.display = 'block';
        });
    } else {
      document.getElementById('Fjournal-suggestions-container').innerHTML = '';
      document.getElementById('Fjournal-suggestions-container').style.display = 'none';
    }
  }
  
  function selectJournalSuggestion(value) {
    var searchBox = document.getElementById('journal-search-box');
    searchBox.value = value;
    document.getElementById('Fjournal-suggestions-container').style.display = 'none';
    searchBox.form.submit();
  }
  
      function showFavJournalSuggestions(query) {
        if (query.length >= 1) {
          fetch('{% url "search_favouriteSuggestion" %}?q=' + encodeURIComponent(query))
            .then(response => response.json())
            .then(data => {
              var suggestionsContainer = document.getElementById('Fjournal-suggestions-container');
              suggestionsContainer.innerHTML = '';
              data.suggestions.forEach(title => {
                const div = document.createElement('div');
                div.textContent = title;
                div.classList.add('search-suggestion'); 
                div.addEventListener('click', function() {
                  selectJournalSuggestion(title); 
                });
                suggestionsContainer.appendChild(div);
              });
              suggestionsContainer.style.display = 'block';
            });
        } else {
          document.getElementById('Fjournal-suggestions-container').innerHTML = '';
          document.getElementById('Fjournal-suggestions-container').style.display = 'none';
        }
      }
      
      function selectJournalSuggestion(value) {
        var searchBox = document.getElementById('journal-search-box');
        searchBox.value = value;
        document.getElementById('Fjournal-suggestions-container').style.display = 'none';
        searchBox.form.submit();
      }  
      
      
      document.getElementById('journal-search-input').addEventListener('input', function(e) {
        const query = e.target.value; 
        showJournalSuggestions(query);
    });
    
    function showJournalSuggestions(query) {
        if (query.length >= 1) {
            fetch(`/search-suggestions/?q=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                    var suggestionsContainer = document.getElementById('journal-suggestions-container');
                   
                    suggestionsContainer.innerHTML = '';
                    
                    data.suggestions.forEach(title => {
                        const div = document.createElement('div');
                        div.textContent = title;
                        div.classList.add('search-suggestion'); 
                        div.addEventListener('click', function() {
                            selectJournalSuggestion(title); 
                        });
                        suggestionsContainer.appendChild(div);
                    });
                    suggestionsContainer.style.display = 'block';
                });
        } else {
            document.getElementById('journal-suggestions-container').innerHTML = '';
            document.getElementById('journal-suggestions-container').style.display = 'none';
        }
    }
    
    document.addEventListener('DOMContentLoaded', (event) => {
        const suggestions = document.querySelectorAll('.search-suggestion');
        suggestions.forEach(function(suggestion) {
          suggestion.addEventListener('click', function() {
            const value = this.textContent || this.innerText; 
            window.location.href = '/search?query=' + encodeURIComponent(value);
          });
        });
      });
    
    
    function selectJournalSuggestion(value) {
        var searchBox = document.getElementById('journal-search-box');
        searchBox.value = value;
        document.getElementById('journal-suggestions-container').style.display = 'none';
         searchBox.form.submit();
    }
    
      
    </script>
    

    <style>
      #search-form .form-control {
        width: auto;
      }
      #search-form .btn {
        width: auto;
      }
      #journal-suggestions-container {
        position: absolute;
        width: auto;
        background: lightblue;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        border-radius: 0 0 5px 5px;
        overflow: hidden;
        z-index: 1000;
      }
      #journal-suggestions-container > div {
        padding: 10px;
        border-bottom: 1px solid #eee;
        cursor: pointer;
      }
      #journal-suggestions-container > div:hover {
        background-color: #f9f9f9;
      }
    
      #Fsearch-form .form-control {
        width: auto;
      }
      #Fsearch-form .btn {
        width: auto;
      }
      #Fjournal-suggestions-container {
        position: absolute;
        width: auto;
        background: lightblue;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        border-radius: 0 0 5px 5px;
        overflow: hidden;
        z-index: 1000;
      }
      #Fjournal-suggestions-container > div {
        padding: 10px;
        border-bottom: 1px solid #eee;
        cursor: pointer;
      }
      #Fjournal-suggestions-container > div:hover {
        background-color: #f9f9f9;
      }
    </style>
  </body>
</html>
