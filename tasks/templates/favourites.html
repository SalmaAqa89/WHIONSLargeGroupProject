
{% extends 'base_content2.html' %}
{% block content %}
<div class="container">
  <div class="row">
    <div class="col-12">
      <link rel="stylesheet" href="search.css">
      <form method="get" action="{% url 'search_favourite' %}" autocomplete="off" id="search-form" class="mb-3">
        <input type="text" name="title" placeholder="Search Favourite Journals..." class="form-control" id="search-box" data-suggestions-url="{% url 'search_favouriteSuggestion' %}" oninput="showSuggestions(this.value)">
        <button type="submit" class="btn btn-primary mt-2">Search</button>
        <div id="suggestionsContainer" class="suggestions-container"></div>
      </form>
      <h1>Welcome to your Favourites</h1>
      <div class = "card-deck">
        {% for entry in journal_entries %}
        {% if not entry.deleted %}
          <div class="card mb-3">
            <div class="card-body">
              <a href="{% url 'unfavourite_entry' entry_id=entry.id %}" class="favourite"><img src="http://www.clker.com/cliparts/g/R/o/O/K/1/simple-star-md.png" height="20" width="20"></a>
              <h5 class="card-title">{{ entry.title }}</h5>
              <h6 class="card-subtitle mb-2 text-muted">{{ entry.created_at }}</h6>
              <p class="card-text">{{ entry.text }}</p>
              <p>Mood: {{ entry.get_mood_display }}</p>
              <a href="{% url 'delete_entry' entry_id=entry.id %}" class="btn btn-danger">Delete Entry</a>
            </div>
          </div>
        {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>
</div>
<script>
function showSuggestions(value) {
 
  if(value.length >= 0) {
    fetch('{% url "search_favouriteSuggestion" %}?q=' + encodeURIComponent(value))
    .then(response => response.json())
    .then(data => {
      let suggestionsHTML = '';
      for(let i = 0; i < data.suggestions.length; i++) {
       
        suggestionsHTML += '<div onclick="selectSuggestion(\'' + data.suggestions[i] + '\')">' + data.suggestions[i] + '</div>';
      }
      document.getElementById('suggestionsContainer').innerHTML = suggestionsHTML;
   
      document.getElementById('suggestionsContainer').style.display = data.suggestions.length > 0 ? 'block' : 'none';
    })
    .catch(error => console.error('Error:', error));
  } else {
    document.getElementById('suggestionsContainer').style.display = 'none';
  }
}

function selectSuggestion(value) {
document.getElementById('search-box').value = value;
document.getElementById('suggestionsContainer').innerHTML = '';
}

</script>



{% endblock %}